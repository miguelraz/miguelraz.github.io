<?xml version="1.0" encoding="UTF-8" ?> <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml"> <title>OnCompilersAndWarehouseMangers.html</title> <meta http-equiv=Content-Type  content="application/xhtml+xml;charset=utf-8"/> <link rel=stylesheet  type="text/css" media=all  href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css" /> <link rel=stylesheet  type="text/css" media=all  href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/github.min.css" /><meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'><style> body { box-sizing: border-box; max-width: 740px; width: 100%; margin: 40px auto; padding: 0 10px; } </style><script id='MathJax-script' async src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'></script><script src='https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js'></script><script>document.addEventListener('DOMContentLoaded', () => { document.body.classList.add('markdown-body'); document.querySelectorAll('pre[lang] > code').forEach((code) => { code.classList.add(code.parentElement.lang); }); document.querySelectorAll('pre > code').forEach((code) => { hljs.highlightBlock(code); }); });</script> [WARNING] Note with key '5' defined at line 150 column 1 but not used. [WARNING] Note with key '7' defined at line 152 column 1 but not used. [WARNING] Note with key '8' defined at chunk line 1 column 1 but not used. [WARNING] Note with key '9' defined at line 154 column 1 but not used. <p><span class=citation  data-cites=def >@def</span> title = â€œğŸš§ WIP: ğŸš§ Programs, Compilers, and Warehouse Managersâ€ <span class=citation  data-cites=def >@def</span> author = â€œMiguel Raz GuzmÃ¡n Macedoâ€ <span class=citation  data-cites=def >@def</span> tags = [â€œcompilersâ€, â€œJITâ€] <span class=citation  data-cites=def >@def</span> rss = â€œThis blog is about trying to explain to non computer people what compilers do, and why JITs are cool and how they fit in that world view.â€ #<span class=citation  data-cites=def >@def</span> rss_pubdate = Date(2022, 01, 19) #<span class=citation  data-cites=def >@def</span> published = â€œ19 January 2022â€</p> <h3 id=reading-time-25-minutes >Reading time: 25 minutes</h3> <h3 id=summary >Summary:</h3> <p>As a soon-to-be physicist, thereâ€™s nothing I value more than a useful lie. A story thatâ€™s simple, captivating, and a good builder for intuition that can last for years â€“ those are the lies that I like. I also like to code in the Julia programming language, and I get very excited talking about very intricate technical details to supportive friends and helpless victims. Not many of my friends and family are into computers, which means I have to come up with great <del>lies</del> stories to talk about compiler optimizations with other people.</p> <p>This is a story that Iâ€™ve told myself (and others) in order to make sense of what the hell a compiler is supposed to do in the best way I know how: by just <em>lying about it</em>, but in a plausibly-deniable, convenient sort of way, until I you can learn to measure otherwise.</p> <p>All imprecisions are my fault, but it is my hope that where I miss the mark, you get a working mental model of how some of these compiler things work.</p> <p>My <strong>useful lie</strong> for the rest of this post is that programs are plans to move boxes of bits around, not completely unlike a â€œwarehouse managerâ€ who must handle daily orders and boxes coming in and out of their warehouse, and that planning upfront or on the fly how to process the boxes is the key difference between compilers and interpreters.</p> <p>Thatâ€™s <em>it</em>, thatâ€™s my post.</p> <p>The rest of it is just narrative frosting, but the TL;DR is:</p> <blockquote> <p>If you think of programs as boxes of bits to be moved around inside a computer, you can plan ahead or do it on the fly. The ones that plan upfront are called <strong>compilers</strong> (languages like C/Rust) and can come up with very efficient ways to move the boxes because they know the sizes of everything before hand and can plan accordingly (make optimizations). <strong>Interpreters</strong> (Python/R) delay planning and trade the convenience of having to plan with just using more storage space and not badgering clients with plans all the time. This means they mostly canâ€™t optimize better routes or shipments of the boxes because they donâ€™t know how much is coming in or when, but thereâ€™s enough space to accommodate their needs (usually). <strong>Speculating JITs</strong> (Javascript) are interpreters that â€œbetâ€ that frequent orders that have been made before will be made again, and so try to make a plan for those when enough identical orders are made. <strong>Type-based JIT Compilers</strong> (Julia) try to figure out the sizes of the boxes when they arrive with fancy tech (type inference algorithms/x-ray goggles to figure out whatâ€™s inside the boxes) and then make a clearing plan like a compiler would. They rely on their fancy tech to work as expected (donâ€™t line your boxes with lead, silly user) and for the order not to be too urgent when they are doing the on-the-fly planning, but they get the compiler speed throughput when things work out.</p> </blockquote> <p>It is my deep held conviction that compilers are explainable to curious children, if one is patient and willing to help the listener build the right <a href="https://www.youtube.com/watch?v=_ahvzDzKdB0">language for it</a>, though perhaps not yet by me. Guy Steele explained Operating Systems in monosyllables in the previous link, and <a href="https://twitter.com/TartanLlama/status/1460608706048106501">Sy Brand helped me understand monads with cats in under 2 minutes.</a> â€“ or at least the gist of it, which is enough for me right now. Both of them are the inspiration for this post and worth your time, so hereâ€™s my own hand in this endeavor.</p> <hr /> <p><strong>Note:</strong> Thereâ€™s a spoiler about all the technical terms at the end if you want to keep going down the rabbit hole, because Iâ€™m all about lowering all the gates and building all the bridges. And if you want to read oodles more, you can always <a href="https://github.com/sponsors/miguelraz/">sponsor me on GitHub</a> to keep the blog rolling along.</p> <hr /> <h3 id=the-warehouse-meet-the-compilers >The warehouse: Meet the compilers</h3> <p>First day at the new gig.</p> <p>It used to be a shoe strings factory, but they retrofitted the place to become the <code>Silly Cones Clearing Warehouse</code>. Right, you forgot theyâ€™re terrible at naming things here. You pull up to the main entrance with your shiny name badge and youâ€™re hailed by a friendly supervisor who kindly gives you the run of the place. Theyâ€™re called Ash<a href="#fn1" class=footnote-ref  id=fnref1  role=doc-noteref ><sup>1</sup></a>, and they help everyone get setup and working with each other.</p> <p>Your job description says youâ€™re a â€œcompiler/interpreterâ€. The supe says both are just moving boxes around with all sorts of bits in them, but your workload will vary widely based on your worksheet details and client specifications.</p> <blockquote> <p>Thereâ€™s basically two shift styles here - lemme show you how the old guard does it first.</p> </blockquote> <p>You nod and follow them to meet the compiler crew.</p> <p>You first met Cece<a href="#fn2" class=footnote-ref  id=fnref2  role=doc-noteref ><sup>2</sup></a>. Everyone seems to have started training with Cece at some point, for better or for worse. Cece tells you that youâ€™re job is quite simple:</p> <blockquote> <p>Hereâ€™s the gig kiddo: We have tons of client orders in-flight all the time. Their orders are shipping boxes, and they go through our warehouse centers. Some clients ask for small deliveries - like a toothbrush - and those fit in those smallest boxes in that register behind ya. Thereâ€™s not many of those but theyâ€™re the easiest and closest. Once that order makes it into the van in the docking bay, you get them all back from the stack over there. Basic rule of thumb here: the closer the boxes, the smaller they are, but the faster you can reuse them.</p> </blockquote> <p>â€œSo Iâ€™m moving knick-knacks all day? Just from our processing unit to the bay?â€</p> <blockquote> <p>Huh, we wish. Those are the small fish. We also get orders for shipping containers that are getting backlogged all over the east coast nowadays - we have to accommodate them all.</p> </blockquote> <p>â€œWhat?â€</p> <blockquote> <p>Yeah, happens all day. Gigs of â€™em.</p> </blockquote> <p>â€œBut shipping containers donâ€™t fit in these toothbrush boxes Cece.â€</p> <blockquote> <p>Well, thatâ€™s why I always ask everyone upfront for the size of everything their sending. If they donâ€™t send me a form sheet, I just send it back. Oh right â€“ a form sheet means that everything the client wants to move through this warehouse must have a specified box size. If they canâ€™t write it down at the time, they must put it a special request with Mally. Thereâ€™s forms behind you to check that all the items actually fit in the boxes they say.</p> </blockquote> <p>â€œYou always do this manually?â€</p> <blockquote> <p>Itâ€™s worked for me, and itâ€™s good you start learning it too, itâ€™s as close to understanding how this warehouse works as youâ€™ll get. Just remember - at Silly Cones, if you ever need more boxes, we can always get more rackspace, you just need to make the paperwork. We have tons of space, but itâ€™s out of town, so your orders will be delayed while we move the stuff back and forth.</p> </blockquote> <p>You sigh at the thought of filling all these forms for boxes by hand all the time, but itâ€™s lunch break already.</p> <hr /> <p>You spend a few weeks with Cece and you get good at what you do. Cece takes particular delight in packing the structures compactly and not wasting more boxes than what they deem necessary; such waste is the ultimate crime.</p> <p>You keep noticing however, that CeCe definitely fudges some of the form sheets - some boxes are just filled with the wrong name, names get overwritten, stuff spills out when it doesnâ€™t fit in the boxes the client asked for and then a few hours of everyoneâ€™s time is wasted picking up the mess. Credit where itâ€™s due - some clients ask exclusively for CeCe and are used to his manual and error-prone ways, something about the devil they knowâ€¦</p> <p>Cece was also devilishly brief about what your assignment <em>actually</em> meant (Cece has a knack for understating complexity in your daily tasks). See, some of these boxes arrive empty but have a tracking code on the side, and so you have to go and find the box in the warehouse that that the tracking code is referring to, because thatâ€™s where your items are actually stored. This is useful because you can get a warning that something is coming, but you donâ€™t know where itâ€™ll be, so you try your best and carry on at whims of the clientâ€™s wishes.</p> <p>On the happy days, you get a full detail sheet of all the concrete things you gotta haul, but boy when you have to chase boxes<a href="#fn3" class=footnote-ref  id=fnref3  role=doc-noteref ><sup>3</sup></a> for everything and drag it around and rewrite the form sheetâ€¦ itâ€™s not fun, or fast AND you have to go back and forth from the form sheets the client gave you and manage the tracking codes manually. Oh and if you miss putting back any of the empty boxes your wages get docked, just to add to the fun of the whole operation. And sometimes they change their mind as youâ€™re 3 tracking code trips into the order and you have to start again â€“ worst of all is when Cece jumps ahead of you and overwrites your order! You guess itâ€™s the price of admission into this gig and hunker on. At least the gig pays.</p> <p>Ash has kept coming around and chatting with you, asking how the box shuffling is treating you and if you like working close to the metal.</p> <blockquote> <p>Hey, you should come with me to bikeshed, thereâ€™s a person you should meet.</p> </blockquote> <p>Youâ€™re on your lunch break and could use a break from stamping forms as <code>null</code> so you take Ash up.</p> <p>Ash introduces you to Rusty<a href="#fn4" class=footnote-ref  id=fnref4  role=doc-noteref ><sup>4</sup></a>, also a part of the compilers team. Heâ€™s fixing his bike chain and hasnâ€™t taken the helmet or high-visibility vest off.</p> <blockquote> <p>Nice to meet you! ğŸ‘·</p> </blockquote> <p>He says. He asks about your last few weeks with Cece and groans reminiscing of all the manual paperwork.</p> <blockquote> <p>â€¦ boy have I been there - Iâ€™ve told Cece a million times thatâ€™s no way to live. If only heâ€™d plan a littleâ€¦</p> </blockquote> <p>Rusty is very enthusiastic about workplace safety and definitely sounds like a fun guy. Rusty started out with Cece but got tired of all the potential accidents and mishaps on the main floor and had to come up with neat hacks for â€œnever facing those problems againâ€:</p> <blockquote> <p>Itâ€™s like a hall pass system for the orders that are coming in - Only one person can hold the permission slip for the order boxes theyâ€™re touching at the time. That way, no one can mess up anyone elseâ€™s orders, because they canâ€™t access them in the first place!</p> </blockquote> <p>Rusty has a smaller working space than Cece, and it takes him a bit longer to work through the form sheets with this added ownership slip system, but he says he never has to worry about all the crap that Cece is used to.</p> <p>Your lunch break is over and you start scuttling back to your station as he mumbles something about â€œmaking errors unrepresentableâ€ and <a href="https://www.youtube.com/watch?v=A3AdN7U24iU">train emergency breaks</a> or something. Rusty talks <strong>fast</strong> and canâ€™t stop talking about trains in general. <strong>Loves</strong> them.</p> <hr /> <h3 id=meet-the-interpreters >Meet the interpreters</h3> <p>Youâ€™ve been clearing oodles of orders with the Rusty system for a few weeks now - youâ€™ve seen almost no box spills since you started with the permission slip system but it seems worth it with the exacting clients Cece gets overwhelmed with, permission slip system and all. Itâ€™s not like Rusty isnâ€™t demanding either - but he has a knack for colors and <a href="https://twitter.com/ekuber/status/1438178928984829959">proactive feedback thatâ€™s a wholesome breath of fresh air</a>. (Colors! How come Cece always wrote all those forms with the same black fountain pen? Rusty at least uses playful stickers every now and thenâ€¦)</p> <p>Ash rolls around again. Ash gives you a glowing performance review but says youâ€™re not going to improve much if you donâ€™t learn from how other people work at the warehouse, and that your next rotation is with the â€œinterpreterâ€ camp.</p> <p>You both stroll to the docking bay where orders are received and Peter<a href="#fn5" class=footnote-ref  id=fnref5  role=doc-noteref ><sup>5</sup></a> is waiting for you. They have a cool snake ğŸ tattoo on one arm and a Jolly Roger in the other â˜  . Peter seems to be living the good life - heâ€™s sitting at a desk filled with many walkie talkies and is reading the papers.</p> <p>You start chatting for a while and you learn that <code>Silly Cones</code> serves many more types of clients than what you have seen with Rusty or Cece:</p> <blockquote> <p>Most of these clients, if you send them back the form sheet, you wonâ€™t hear from them again. Thatâ€™s why itâ€™s just best to receive all their orders here, unbox it in the docking bay and figure out what they need and call for backup if we donâ€™t have enough space.</p> </blockquote> <p>â€œSo whatâ€™s with all the phones?â€</p> <blockquote> <p>Well, I need to call loads of our network warehouses to check if they have the stuff - we donâ€™t have enough unboxing space in the docking bays here, so thatâ€™s why Iâ€™m always calling other warehouses to see if they have the stuff that the tracking number is redirecting to.</p> </blockquote> <p>â€œSo most of your time youâ€™re just waiting for the boxes to arrive?â€</p> <blockquote> <p>Yup! Or unboxing and chasing them around here. There might be some processing here but thereâ€™s always breaks when things havenâ€™t arrived. Oh, and calling other places to see if the boxes are there too - sometimes finding it is the worst part, but thatâ€™s why we have all these radios to call them.</p> </blockquote> <p>Well this new lifestyle of luxurious time waste is new to you, but the clients are raving for the lazy approach that Petey provides. He even got a tattoo of <code>tang ping</code> across the knuckles but youâ€™re sure the bosses wouldâ€™ve <a href="https://www.nytimes.com/2021/07/03/world/asia/china-slackers-tangping.html">seen it by now</a>.</p> <blockquote> <p>Interpreters however, take a different approach - They bank on this incredible trove of available out-of-town warehouses that can fetch boxes as they need them. Theyâ€™ve also evolved a strategy to be as lazy as possible: their clients usually donâ€™t have the time to prepare form sheets for their orders, so itâ€™s not worth worrying about. Instead, they have their clients always send boxes with addresses to other boxes - they must always open to boxes to figure out what is inside and where itâ€™s stored. They gain a lot of flexibility, but they trade it off for not being able to plan ahead with the order forms, and most of their time is wasted chasing down boxes in different warehouses and accounting for not losing any of them.</p> </blockquote> <blockquote> <p>These interpreters figured out they could probably do better and so 2 new strategies arose - the gamblers and the techies. The gambling interpreters figured that almost every monday at 7am, the same order by the same clients came along. So when they started seeing the same orders come in too many times, they tried to plan ahead to â€œfast trackâ€ those boxes to be cleared through the warehouse without looking inside the boxes. Sometimes they get it wrong (like any speculation), and they have to fall back on the lazy style of unboxing, but they can clear a lot of order flows surprisingly quickly. The techies however went for a hybrid approach - they had to nerd out and create some really fancy X-Ray goggles to find whatâ€™s inside the boxes when the arrive (like the interpreters) but then fill out order forms and plan accordingly once they know the sizes and save it in a special file cabinet. When the same order rolls around again, they can execute like the compilers.</p> </blockquote> <p>==== (â€¦ all of this)</p> <section class=footnotes  role=doc-endnotes > <hr /> <ol> <li id=fn1  role=doc-endnote ><p><code>Ash</code> is supposed to be <code>bash</code> the languages used to install stuff and compile/run programs from your terminal.<a href="#fnref1" class=footnote-back  role=doc-backlink >â†©ï¸</a></p> <li id=fn2  role=doc-endnote ><p><code>Cece</code> is supposed to be the <code>C</code> programming language, because in <code>make</code> scripts itâ€™s the name of the C compiler variable <code>CC=gcc</code> or something like that. His manual style of asking for all sizes upfront is indicative of a compiled programming language - They can be fast, and waste little space.<a href="#fnref2" class=footnote-back  role=doc-backlink >â†©ï¸</a></p> <li id=fn3  role=doc-endnote ><p>unboxing -<a href="#fnref3" class=footnote-back  role=doc-backlink >â†©ï¸</a></p> <li id=fn4  role=doc-endnote ><p><code>Rusty</code> - Rusty is supposed to be Rust, the programming language that trades compile time for the safety guarantees that an ownership system/hall pass system/mutually exclusive access gives.<a href="#fnref4" class=footnote-back  role=doc-backlink >â†©ï¸</a></p> <li id=fn5  role=doc-endnote ><p>Peter is supposed to be Python and R, the interpreted languages (worst pun joined name ever).<a href="#fnref5" class=footnote-back  role=doc-backlink >â†©ï¸</a></p> </ol> </section>